## 自适应限流算法

参考 tcp bbr 算法、go-zero、kratos 实现

算法原理其实很简单：
就是根据 cpu 负载和请求负载来判断要不要限流，有一些要点如下：
1. 也可以使用其它设备负载，不过 cpu 显然是限制最大的，所以就是用当前请求的 cpu 使用率来判断即可，而 cpu 负载的统计可以每次都获取，也可以定时获取
2. 请求负载怎么统计？其实很简单，就是获取历史上能够通过的最大请求量，然后再根据当前的请求量来判断，要不要限流，这里展开也有几个问题：
2.1 只是历史请求量就行吗？其实不然，因为机器的负载一直在变动，最好取最近一段时间的最大请求量比较好，比如前 5min 的
2.2 怎么统计当前的请求量？这个可能需要处理一下
2.3 怎么统计过去 x 分钟的最大请求量？这个可以根据滑动窗口算法来采集

一般来说，直接根据这两个负载就能够判断了，不过 kratos 还做了优化，就是当 cpu 负载小于 80% 后，不是直接判断请求负载，而是先判断一下上一次限流的时间，然后再去判断请求负载，这样是为了减少限流之后 cpu 负载降低那瞬间出现的毛刺


## 参考
https://lailin.xyz/post/go-training-week6-4-auto-limiter.html
https://github.com/go-kratos/kratos/blob/v1.0.x/pkg/ratelimit/bbr/bbr.go
https://github.com/sado0823/go-bbr-ratelimit
